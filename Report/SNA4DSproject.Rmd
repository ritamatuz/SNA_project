---
title             : "Migratory Determinants Between Member-States of the OECD"
shorttitle        : "A SNA4DS Report"

author: 
  - name          : "First Author"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Postal address"
    email         : "my@email.com"
    role:         # Contributorship roles (e.g., CRediT, https://casrai.org/credit/)
      - Conceptualization
      - Writing - Original Draft Preparation
      - Writing - Review & Editing
  - name          : "Ernst-August Doelle"
    affiliation   : "1,2"
    role:
      - Writing - Review & Editing

affiliation:
  - id            : "1"
    institution   : "Wilhelm-Wundt-University"
  - id            : "2"
    institution   : "Konstanz Business School"

authornote: |
  Add complete departmental affiliations for each author here. Each new line herein must be indented, like this line.

  Enter author note here.


keywords          : "keywords"
wordcount         : "X"

bibliography      : ["r-references.bib"]

toc               : yes
toc_float         : yes
floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : no
mask              : no
draft             : no

documentclass     : "apa6"
classoption       : "man"
output            : word_document
---

```{r setup, include = FALSE}
library("papaja")
r_refs("r-references.bib")
```

```{r analysis-preferences, include = FALSE}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```



# Citations in papaja, detele appropriately later

Add the bibtex entry in the .bib file. You can find the entries in Google scholar, 
but double check since it is not always correct. 

Call the citations in the text:

Citation within parentheses	[@R-papaja]

Multiple citations	[@R-papaja; @R-base]

In-text citations	@R-papaja

Year only	[-@R-base]

Only if your citation appears in the text it will also show up in the Reference 
list. Don't manually modify the Reference list.

## Executive Summary 

(150 words) – 0.3 POINTS
Summarize the report. Write this as the very last thing.

What is the main topic you are addressing?

what are your research questions and hypotheses?  

what are your results and the main conclusion?



## Introduction 

### Determinants of international migration

International migration is an important feature of global economy, continuously shaping the demographics of our globalized world. It is predicted that international migration is likely to grow and become more complex in the coming decades, due to factors such as an aging population, growing economic inequalities and climate change [@klugman2009human]. As it has an impact on receiving as well as sending countries, researching why people migrate, how they choose their destination countries, and how this migration changes over time are important to better understand global trends and inform policy decisions.

One of the classical methods for investigating the determinants of migration are gravity models [@boyle2014exploring], their main components are population size and geographical proximity. There are more factors that influence migration according to the available literature, and these are typically grouped in two categories: push and pull factors [@langley2016push]. Push factors are those associated with the country of origin of the migrant and are related to their decision to migrate, examples of these are natural disasters, violence, poverty, and unemployment. Pull factors are associated with the destination country of the migrant, these can be economic prosperity and employment opportunities, favourable climate, and political stability. Migration movements can also be encouraged by homophily in the dominant religion and language, which lower the expected costs of acculturation [@belot2012cultural]. 

### Network perspective

The flows of international migration naturally constitute a directed and valued network where nodes represent countries. The outbound edges are the number of citizens each country sends to every other country in the network, this way the inbound edges of a node represent the number of citizens received from each country. Characteristics describing the nodes and the edges between them can be included as covariates.

Statistical network analysis captures the interconnectedness of countries and allows for the influence of various factors on migration to be measured without assuming independence that does not hold in migration data [@desmarais2012statistical]. Despite network analysis being suitable for modelling such phenomena, to this day surprisingly few studies have used this perspective to better understand international migration [@fagiolo2013international, @tranos2015international, @windzio2018network].

An example of a study that looks at international migration from a network perspective was conducted by @windzio2018network. Their results from a global dataset were in line with the gravity models and theories of global inequality when examining the determinants of migration using temporal and cross-sectional exponential random graph models (ERGMs). ERGM is a method for statistical inference on networks, which, given a number of statistics that capture the essential generative structures of the network, estimates the probability of the observed network [@cranmer2011inferential]. This method takes into account the interdependent nature of migration and allows for modelling both endogenous dependencies and exogenous covariates of the network. Instead of flows of migrants, however, @windzio2018network used data on stocks of persons born in a different country, and instead of looking at the number of migrants, they used quartiles of the measure of the migration distribution in order to reduce the data into a binary network. While ERGMs are a ubiquitous means of network analysis, their inability to model networks with valued edges is a strong limitation for modelling migration networks, as thresholding weighted edges into binary ones leads to a considerable loss of information on the vastly different magnitudes of migration that different edges of the network represent.

The generalized exponential random graph model (GERGM), developed by @desmarais2012statistical, is a method that generalizes ERGMS to be used for value-edged networks, making it suitable for studying migration networks. @desmarais2012statistical used GERGMs to model interstate migration flows within the United States, and @abramski2018network used the method to study refugee migration flows from four countries experiencing violent conflicts, finding that the GERGM is a better way for modelling this specific problem compared to the ERGM.

### Our research

In this report, we aim to contribute to the literature on international migration by examining it from a network perspective using generalized random graph models. Using a dataset of migration flows within the member countries of the Organization for Economic Co-operation and Development (OECD) in 2019, we look at the properties of this network and set up a model on the determinants of international migration.

Using the network perspective, it becomes possible to quantify the network properties of the international migration network. It is generally assumed that migration networks exhibit a high level of clustering [@fagiolo2013international], but to statistically test this proposition, we apply a conditional uniform graph (CUG) test. We focus our attention to clustering only, as this is a network-level measure for which a generalization has been proposed and implemented which is suitable for weighted networks [@opsahl2009clustering].

_Research question 1: Does the international migration network of the OECD countries exhibit a high degree of clustering?_

_Hypothesis 1: The international migration network of the OECD countries exhibits a high degree of clustering._

We examine the effects of several driving factors of migration suggested by earlier literature: population, population density, shared borders, shared language, shared religion, GDP, crime index, freedom index, and unemployment rate [@belot2012cultural, @langley2016push, @windzio2018network]. Our contribution is examining this subject from the network perspective and employing GERGM, a model that is highly suitable for this kind of data but has not been used in the research of international migration before. This model allows for the inclusion of endogenous effects, regarding which we hypothesise that there is no significant reciprocity in the network, similarly to the interstate migration network within the United States studied by @desmarais2012statistical. 

_Research question 2: What factors drive migration within the OECD countries?_

_Hypothesis 2: Large population, high population density, low GDP, high crime, low freedom, and high unemployment rate are push factors of international migration within OECD countries._

_Hypothesis 3: Large population, high population density, high GDP, low crime, high freedom, and low unemployment rate are pull factors of international migration within OECD countries._

_Hypothesis 4: Sharing the same dominant language, religion, as well as sharing borders increases migration between OECD countries._

_Hypothesis 5: The international migration network of the OECD countries does not exhibit reciprocity._

The structure of the rest of the report is as follows. The method section explains the data used in this study, and the methods we use to run our analysis. Subsequently, the results section presents and discusses the outcomes of the analysis for each research question respectively. Finally, the report is closed with a short conclusion section.


## Methodology

### Dataset 
(about 500 words) 1 POINT (+ BONUS)
*	Which data set are you going to use? Three options:

o	Use readily/easily available data (0 bonus points)

o	Combine two or more existing datasets (max 0.5 bonus points)

o	Scrape or collect your own data (max. 1 bonus point)

*	Clearly explain where the data is coming from:

o	Who collected the data?

o	What is the source?

o	When was the data produced?

o	How was the data collected?

*	Provide descriptive measures of your data (tables, plots, etc.)

*	Why is this data useful to study your topic and answer your research questions?

*	What is the potential bias in the data? How does this affect your results?

### Data analysis (Research Rationale)
Research question 1 investigates the degree of clustering within the network of internal migration among OECD countries. Clustering in a network is a form of graph level index or network descriptive statistic [@butts2008social], [@cranmer2020inferential]. These types of descriptive statistics are useful for understanding attributes of a network, such as clustering, centralization, transitivity or reciprocity [@cranmer2020inferential]. The network generation process by itself does not trivially translate into a clear answer, such as "there is a high degree of clustering," which is where the conditional uniform graph (CUG) method is useful. It works by constructing a null hypothesis, or benchmark, which does not include a tendency towards the process we wish to study (meaning that the null distribution generated would not involve a high degree of clustering). This null distribution creation is often created through the use of Monte Carlo distributions, and ensures this benchmark that can be tested against [@butts2008social].  

Research question 2 investigates which factors drive migration between the OECD countries. Several papers have been published using GERGMs to explain migratory patterns, but these focus on refugees [@abramski2019network] or intra-national migration [@aksoy2020model]. On the other hand, it is more common in literature to use ERGMs to study both international and intra-national migration [@windzio2021network], [@nourpanah2018intersecting], [@belkhiria2019application]. At the time of writing, the Google Scholar search results for "GERGM migration" number 23, whereas "ERGM migration" numbers 739. While this is not completely accurate because it is an unsupervised search result, it does provide an indication. It is our wish to expand on literature and test the robustness of the GERGM model. The ERGM and GERGM both evaluate endogenous and exogenous factors, but the ERGM does not allow for valued edges, whereas the GERGM does. Patterns of migration among countries are not binary, and investigating how the values of migration between countries affects the overall migration network could be beneficial in understanding migratory patterns, and shed light upon factors not previously found. 




## Results
(about 2000 words)

### Model 1
(about 1000 words) – 2.5 POINTS

*	Present your results appropriately (plots, tables…) and discuss your findings 
in plain English

*	Discuss the meaning of your findings in relation to your hypothesis. (half of
the points evaluated in this other part)


```{r echo = FALSE, results = 'asis'}
# table example
cn <- c("age", "gender", "eyes_col")
one <- c(7, "M", "BLUE")
two <- c(8, "F", "BROWN")
three <- c(8, "M", "GREEN")
four <- c(7, "F", "PINK")

tab <- rbind(cn, one, two, three, four)
rownames(tab) <- NULL
knitr::kable(tab)
```

Option 1: 

```{r model 1, echo = FALSE}
# model results display example
ctl <- c(4.17,5.58,5.18,6.11,4.50,4.61,5.17,4.53,5.33,5.14)
trt <- c(4.81,4.17,4.41,3.59,5.87,3.83,6.03,4.89,4.32,4.69)
group <- gl(2, 10, 20, labels = c("Ctl","Trt"))
weight <- c(ctl, trt)
lm.D9 <- lm(weight ~ group)
lm.D90 <- lm(weight ~ group - 1)

# install.packages("texreg")

knitr::kable(texreg::matrixreg(lm.D9))


```

Option 2

```{r model 2, echo = FALSE, results = 'asis'}
# model results display example
ctl <- c(4.17,5.58,5.18,6.11,4.50,4.61,5.17,4.53,5.33,5.14)
trt <- c(4.81,4.17,4.41,3.59,5.87,3.83,6.03,4.89,4.32,4.69)
group <- gl(2, 10, 20, labels = c("Ctl","Trt"))
weight <- c(ctl, trt)
lm.D9 <- lm(weight ~ group)
lm.D90 <- lm(weight ~ group - 1)

# install.packages("texreg")

knitr::kable(texreg::matrixreg(list(lm.D9, lm.D90)))


```


Option 3

```{r model 3, echo = FALSE}
# model results display example
ctl <- c(4.17,5.58,5.18,6.11,4.50,4.61,5.17,4.53,5.33,5.14)
trt <- c(4.81,4.17,4.41,3.59,5.87,3.83,6.03,4.89,4.32,4.69)
group <- gl(2, 10, 20, labels = c("Ctl","Trt"))
weight <- c(ctl, trt)
lm.D9 <- lm(weight ~ group)
lm.D90 <- lm(weight ~ group - 1)

# install.packages("texreg")


texreg::plotreg(lm.D9)


```


Option 4

```{r model 4, echo = FALSE}
# model results display example
ctl <- c(4.17,5.58,5.18,6.11,4.50,4.61,5.17,4.53,5.33,5.14)
trt <- c(4.81,4.17,4.41,3.59,5.87,3.83,6.03,4.89,4.32,4.69)
group <- gl(2, 10, 20, labels = c("Ctl","Trt"))
weight <- c(ctl, trt)
lm.D9 <- lm(weight ~ group)
lm.D90 <- lm(weight ~ group - 1)

# install.packages("texreg")

texreg::plotreg(list(lm.D9, lm.D90))

```



### ERGM 
(about 1000) – 2.5 POINTS

As discussed earlier in the report, we use a GERGM in order to be able to use weights on the edges in the network. The following covariates are considered: population, population density, GDP, crime index, freedom index, unemployment index, language, borders. Other factors of the GERGM include the edges, in2stars, out2stars, and mutual. The in2stars attribute reflects popularity within a network, out2stars reflects sociality, and mutual reflects reciprocity. 

Several models were tested, but only two of them are investigated in this report. 

The first model takes the data how it is, using directed edge values between nodes as the number of migrations between the countries. Furthermore, each country has sender and receiver values of population, population density, GDP, crime index, freedom index, unemployment index. The language, the religion, the borders and the in2stars, out2stars, and mutual are also inputs. As such, both endogenous and exogenous factors are tested for. 

#### Model 1
```{r GERGM model 1}
# Import data
covariates <- read.table("../data_final/covariates.csv", row.names = 1, sep = ";", header = TRUE)
borders <- as.matrix(read.table("../data_final/borders_adjacency_matrix.csv",sep = ";", row.names = 1, header = TRUE))
migration <- as.matrix(read.table("../data_final/migration_adjacency_matrix.csv", sep = ";", row.names = 1, header = TRUE))


formula <- migration ~ 
                        edges + 
                        sender("Population") + 
                        receiver("Population") +
                        sender("Population_Density") +
                        receiver("Population_Density") +
                        sender("GDP") +
                        receiver("GDP") +
                        sender("Crime_Index") +
                        receiver("Crime_Index") +
                        sender("Freedom_2020") +
                        receiver("Freedom_2020") +
                        sender("Unemployment_2020") +
                        receiver("Unemployment_2020") +
                        nodematch("Language") +
                        netcov(borders) +
                        in2stars(alpha = 0.8) +
                        out2stars(alpha = 0.8) +
                        mutual(alpha = 0.8)


model <- GERGM::gergm(formula,
                      covariate_data = covariates,
                      number_of_networks_to_simulate = 400000,
                      thin = 1/100,
                      proposal_variance = 0.05,
                      MCMC_burnin = 10000,
                      seed = 456,
                      convergence_tolerance = 0.5,
                      maximum_number_of_theta_updates = 10,
                      maximum_number_of_lambda_updates = 10)

gof <- GERGM::GOF(model, return_GERGM_Object = TRUE)

```

```{r Print GERGM model 1}
# Print in a different block in case of errors in the previous one (don't want to have to repeat blocks which take a long time)
install.packages("texreg")
texreg::plotreg(list(model, gof))
```

```{r Significance of GERGM model 1}
# Check for significance
(EstSE <- rbind(t(attributes(model)$theta.coef), t(attributes(model)$lambda.coef)))
EstSE_df = as.data.frame(EstSE)

EstSE_df$LOWER = EstSE_df$est - EstSE_df$se*(-qnorm((1-0.95)/2))
EstSE_df$UPPER = EstSE_df$est + EstSE_df$se*(-qnorm((1-0.95)/2))

# If LOWER and UPPER have the same sign (positive/negative) then there's significance
EstSE_df$Significant = (EstSE_df$LOWER > 0 & EstSE_df$UPPER > 0) | (EstSE_df$LOWER < 0 & EstSE_df$UPPER < 0)
knitr::kable(texreg::matrixreg(EstSE_df)) # TODO check the right function in this table

```

The resulting model has the observed and simulated statistics as quite similar to each other, as can be seen in the goodness of fit plots. However, none of the attributes other than in2stars, out2stars, the intercept and dispersion are significant. This implies that Hypotheses 2, 3, 4 do not hold, and Hypothesis 5 does. This does not fit with the earlier research results of @belot2012cultural, @langley2016push and @windzio2018network, who find that each of these factors is significant. This is surprising because the simulated does fit well with the observed one, which seems to imply that our results would be similar to previously found ones in the literature. It may be caused by an unresolved high level of skewness in the data, as is shown below. To attempt to resolve this, model 2 is introduced in the Model 2 sub-section.

```{r Skewness}
h <- hist(migration, breaks = 100)

xfit <- seq(min(migration), max(migration), length = 40)
yfit <- VaRES::dlogcauchy(xfit, mu=0, sigma=1, log=FALSE)
ayfit <- yfit * diff(h$mids[1:2]) * length(migration)

textreg::plotreg(lines(xfit, yfit, col = "red", lwd = 2))
```

For the first model, in2stars and out2stars are significant, which indicates that other factors that we did not account for are significant in simulating the network. Popularity and sociality, which are endogenous to the network, are therefore significant factors. This can be interpreted as meaning that popularity and sociality exist to a significant degree in the network; e.g., some countries are more likely to take in immigrants, while others are more likely to send out emigrants. As mutual—or reciprocity—is not a significant attribute, it means that countries do not equally share migration streams between each other. 

These results suggest that within the OECD countries, population size, population density, GDP, crime, freedom, unemployment are not push-pull factors in migration (Hypotheses 2, 3). The OECD countries are countries that are relatively well-off and generally viewed as the "first-world"; modern, industrial countries. Previous research has focused on migration primarily in the form of refugees, or where one side of the migration is better off than the other side in aspects such as GDP, freedom, or crime, or others investigated. Most of the countries within the OECD do not differ too greatly in these attributes, which could be an explanation for why these factors are not significant motivators of migration within the network of observed countries. <!-- TODO check this last sentence, check variance level of these attributes -->

Language, religion, and borders are not significant within OECD countries either (Hypothesis 4). This could be explained by the fact that most of the countries investigated do not border each other or share a common language. It further suggests that having a shared language or religion does not significantly affect migration either. There are therefore other factors which are more encouraging for migration to happen. Perhaps these factors are personal and relatively unique to individuals who migrate within OECD countries, such as job opportunities which are not readily available within their own countries, or the wish to live in a more popular country. 

It is somewhat confounding that none of the investigated factors contribute significantly to migration. Some countries have more immigration (popularity) and others have more emigration (sociality) which suggests that there is a cause for these trends in migration. In an attempt to investigate whether these factors may indeed be significant, we introduce the second model.

#### Model 2
@abramski2020complex performed similar research on inter-country migration, and decided that, due to a high degree of skewness in the data, to log the population and GDP, as well as the edge values. Then, instead of the default Cauchy distribution, Log Cauchy is used. In an attempt to find if some attributes may be significant, we investigate this path as well. 

```{r GERGM model 2}
covariates_logged <- data.frame(covariates)
covariates_logged$Population <- log(covariates_logged$Population)
covariates_logged$GDP <- log(covariates_logged$GDP)
migration_logged <- log(migration)
migration_logged[migration_logged == -Inf] <- 0.01

formula_logged <- migration_logged ~ 
                        edges + 
                        sender("Population") + 
                        receiver("Population") +
                        sender("Population_Density") +
                        receiver("Population_Density") +
                        sender("GDP") +
                        receiver("GDP") +
                        sender("Crime_Index") +
                        receiver("Crime_Index") +
                        sender("Freedom_2020") +
                        receiver("Freedom_2020") +
                        sender("Unemployment_2020") +
                        receiver("Unemployment_2020") +
                        nodematch("Religion") +
                        netcov(borders) +
                        in2stars(alpha = 0.8) +
                        out2stars(alpha = 0.8) +
                        mutual(alpha = 0.8)

model_logged <- GERGM::gergm(formula_logged,
                      covariate_data = covariates_logged,
                      number_of_networks_to_simulate = 100000,
                      thin = 1/100,
                      proposal_variance = 0.05,
                      MCMC_burnin = 10000,
                      transformation_type = "LogCauchy",
                      # hyperparameter_optimization = TRUE,
                      seed = 456,
                      convergence_tolerance = 0.5,
                      maximum_number_of_theta_updates = 10,
                      maximum_number_of_lambda_updates = 10)

gof_logged <- GERGM::GOF(model_logged, return_GERGM_Object = TRUE)

```

```{r Print GERGM model 2}
# Print in a different block in case of errors in the previous one (don't want to have to repeat blocks which take a long time)
install.packages("texreg")
texreg::plotreg(list(model_logged, gof_logged))
```

```{r Significance of GERGM model 2}
(EstSE_log <- rbind(t(attributes(model_logged)$theta.coef), t(attributes(model_logged)$lambda.coef)))

EstSE_df_log = as.data.frame(EstSE_log)

EstSE_df_log$LOWER = EstSE_df_log$est - EstSE_df_log$se*(-qnorm((1-0.95)/2))
EstSE_df_log$UPPER = EstSE_df_log$est + EstSE_df_log$se*(-qnorm((1-0.95)/2))

# If LOWER and UPPER have the same sign (positive/negative) then there's significance
EstSE_df_log$Significant = (EstSE_df_log$LOWER > 0 & EstSE_df_log$UPPER > 0) | (EstSE_df_log$LOWER < 0 & EstSE_df_log$UPPER < 0)
knitr::kable(texreg::matrixreg(EstSE_df_log))
```


These results show that all attributes except for crime are significant. This fits the earlier research much better [@belot2012cultural, @langley2016push, @windzio2018network]. It would, in fact, potentially validate hypotheses 2, 3, 4 and invalidate hypothesis 5. The resulting graphs displaying the accuracy of the simulated statistics vs. the observed statistics are, however, significantly worse than the previous model. This is true for models using both Cauchy and Log Cauchy transformations (not shown in this report). Due to the goodness of fit graphs being poor, it is not possible to use the results of this second model, which accounts for skewness. Therefore, we maintain that within OECD countries, the general attributes which are considered push-pull factors do not apply. It remains open to investigation which techniques handle skewness and result in proper goodness of fits. Furthermore, the investigation of which factors apply for push-pull migration among the OECD countries also remains open to for future research. 





## Conclusion

(about 350 words) – 0.7 POINTS
What were your topic and research questions again? (1 sentence)

What did you learn from the two analysis you run? *** most important point to 
address 0.5 POINTS here

Who benefits from your findings?

What does remain an open problem?

Can you give suggestions for future work in this area?



\newpage

# References

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id="refs" custom-style="Bibliography"></div>
\endgroup
